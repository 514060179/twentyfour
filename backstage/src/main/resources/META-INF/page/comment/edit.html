<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.0
Version: 1.5.2
Author: KeenThemes
Website: http://www.keenthemes.com/
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
-->
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title>24占|twentyfour</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <meta name="MobileOptimized" content="320">
<script src="${base!}/assets/jquery-3.1.1.min.js"></script>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed">
<!-- head 头 -->
<#include "../common/head.html"/>
<!-- END HEADER -->
<!-- BEGIN CONTAINER -->
<div class="page-container">
    <!-- 菜单 -->
    <#include "/ftl/menu.ftl"/>
    <!-- END SIDEBAR -->
    <!-- BEGIN PAGE -->
    <div class="page-content">
        <!-- BEGIN PAGE HEADER-->
        <div class="row">
            <div class="col-md-12">
                <!-- BEGIN PAGE TITLE & BREADCRUMB-->

                <ul class="page-breadcrumb breadcrumb">
                    <li class="btn-group">
                        <a href="${base!}/admin/comment/list"><button type="button" class="btn grey dropdown-toggle"  data-hover="dropdown" data-delay="1000" data-close-others="true">
                            返回列表
                        </button></a>
                    </li>
                    <li>
                        <i class="icon-home"></i>
                        <a href="index.html">首页</a>
                        <i class="icon-angle-right"></i>
                    </li>
                    <li>
                        <a href="${base!}/admin/comment/list">评论管理</a>
                        <i class="icon-angle-right"></i>
                    </li>
                    <li><a href="#"><#if look??>查看评论信息<#else><#if comment??>编辑评论信息#${comment.commentId}<#else>新增运势信息</#if></#if></a></li>
                </ul>
                <!-- END PAGE TITLE & BREADCRUMB-->
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <!-- BEGIN VALIDATION STATES-->
                <div class="portlet box gainsboro">
                    <div class="portlet-body form">
                        <div class="form-body">
                            <!-- BEGIN FORM-->
                            <h3 class="form-section"><#if look??>查看评论信息<#else><#if comment??>编辑评论信息#${comment.commentId}<#else>新增评论信息</#if> </#if> <small></small></h3>
                            <form action="#" id="form1" class="form-horizontal" novalidate="novalidate">
                            <#if look??>
                            <div class="row-fluid">
                            <div class="row">
                            <div class="span3 col-sm-2" ></div>
							<div class="span6 col-sm-8">
                            	<span style="display: none" class="form-control"><#if comment??>${comment.commentId!}</#if></span>
                            	<fieldset>
                            		<legend style="font-weight: bold;">评论信息</legend>
									<div class="form-group">
									   	<label class="col-sm-2 control-label;font-weight: bold;">评论类型</label>
									   	<div class="col-sm-4">
									   		<#if comment??>
                                    			<#if comment.ctType??>
                                    				<#if comment.ctType=1>文章</#if>
                                    				<#if comment.ctType=2>商品</#if>
                                    			</#if>
                                    		</#if>
									   	</div>
								    </div>
									<div class="form-group">
										<#if comment??>
											<#if comment.ctType??>
												<#if comment.ctType=2>
												   	<label class="col-sm-2 control-label;font-weight: bold;">商品ID</label>
												   	<div class="col-sm-4">
												   		${comment.ctProductId!}
												   	</div>
									   			</#if>
									   			<#if comment.ctType=1>
												    <label class="col-sm-2 control-label;font-weight: bold;">文章ID</label>
												   	<div class="col-sm-4">
												   		${comment.ctArticleId!}
												   	</div>
									   			</#if>
									   		</#if>
									   	</#if>
									   	<label class="col-sm-2 control-label;font-weight: bold;">评论者ID</label>
									   	<div class="col-sm-4">
									   		${comment.ctDiscussantId!}
									   	</div>
								    </div>
								    <div class="form-group">
								    	<label class="col-sm-2 control-label;font-weight: bold;">评论内容</label>
									   	<div class="col-sm-10">
									   		${comment.ctContent!}
									   	</div>
								    </div>
								    <div class="form-group">
								    	<label class="col-sm-2 control-label;font-weight: bold;">创建时间</label>
									   	<div class="col-sm-4">
									   		<#if comment??>${(comment.ctCreateTime?string("yyyy-MM-dd HH:mm:ss"))!}</#if>
									   	</div>
								    	<label class="col-sm-2 control-label;font-weight: bold;">是否可见</label>
									   	<div class="col-sm-4">
									   		<#if comment??>
                                    			<#if comment.ctType??>
                                    				<#if comment.ctType=1>不可见<#else>可见</#if>
                                    			</#if>
                                    		</#if>
									   	</div>
								    </div>
                            	</fieldset>
                            	<#if comment??>
                            		<#if comment.tfArticle??>
                            			<fieldset>
                            				<legend style="font-weight: bold;">文章信息</legend>
											<div class="form-group">
											   	<label class="col-sm-2 control-label;font-weight: bold;">文章ID</label>
											   	<div class="col-sm-4">
											   		${comment.tfArticle.articleId!}
											   	</div>
											    <label class="col-sm-2 control-label;font-weight: bold;">大师ID</label>
											   	<div class="col-sm-4">
											   		${comment.tfArticle.aMasterId!}
											   	</div>
										    </div>
											<div class="form-group">
											   	<label class="col-sm-2 control-label;font-weight: bold;">文章类型</label>
											   	<div class="col-sm-4">
											   		${comment.tfArticle.aType!}
											   	</div>
											    <label class="col-sm-2 control-label;font-weight: bold;">文章标题</label>
											   	<div class="col-sm-4">
											   		${comment.tfArticle.aTitle!}
											   	</div>
										    </div>
                            			</fieldset>
                            		</#if>
                            		<#if comment.tfProduct??>
                            			<fieldset>
                            				<legend style="font-weight: bold;">商品信息</legend>
											<div class="form-group">
											   	<label class="col-sm-2 control-label;font-weight: bold;">商品ID</label>
											   	<div class="col-sm-4">
											   		${comment.tfProduct.productId!}
											   	</div>
											    <label class="col-sm-2 control-label;font-weight: bold;">商品名称</label>
											   	<div class="col-sm-4">
											   		${comment.tfProduct.pName!}
											   	</div>
											</div>
											<div class="form-group">
											   	<label class="col-sm-2 control-label;font-weight: bold;">商品介绍</label>
											   	<div class="col-sm-4">
											   		${comment.tfProduct.pIntroduction!}
											   	</div>
											    <label class="col-sm-2 control-label;font-weight: bold;">产品归属地</label>
											   	<div class="col-sm-4">
											   		${comment.tfProduct.pAttribution!}
											   	</div>
											</div>
                            			</fieldset>
                            		</#if>
                            		<#if comment.tfUser??>
	                            		<fieldset>
											<legend style="font-weight: bold;">用户信息</legend>
											<div class="form-group">
											   	<label class="col-sm-2 control-label;font-weight: bold;">用户ID</label>
											   	<div class="col-sm-4">
											   		${comment.tfUser.userId!}
											   	</div>
											    <label class="col-sm-2 control-label;font-weight: bold;">用户昵称</label>
											   	<div class="col-sm-4">
											   		${comment.tfUser.uNick!}
											   	</div>
											</div>
											<div class="form-group">
											   	<label class="col-sm-2 control-label;font-weight: bold;">用户手机</label>
											   	<div class="col-sm-4">
											   		<#if comment.tfUser.uTel??>
											   			<#if comment.tfUser.uCountryCode??>
											   				${comment.tfUser.uCountryCode!}-${comment.tfUser.uTel!}
											   			<#else>
											   				${orcommentder.tfUser.uTel!}
											   			</#if>
											   		</#if>
											   	</div>
										  </div>
											
										</fieldset>
									</#if>
                            	</#if>
			                </div>
			                <div class="span3 col-sm-2"></div>
			                </div> 
			                </div>  
                            <#else>
                            <input style="display: none" class="form-control" id="commentId" name="commentId" value="<#if comment??>${comment.commentId!}</#if>"/>
                            <div class="form-group">
                                <label class="control-label col-md-3">评论类型</label>
                                <div class="col-md-4">
                                	<select class="form-control" name="type" id="type" onchange="select(this);" <#if comment??>disabled</#if>> 
								      <option value="1" <#if comment??><#if comment.ctType=1>selected</#if></#if>>文章</option> 
								      <option value="2" <#if comment??><#if comment.ctType=2>selected</#if></#if>>商品</option> 
								    </select>
                            	</div>
                            </div>
                            <div class="form-group"
                            	style="<#if comment??><#if comment.ctType??><#if comment.ctType=1>display:block<#else>display:none</#if></#if><#else>display:block</#if>"
                            	id="articleDiv">
                                <label class="control-label col-md-3">文章ID</label>
                                <div class="col-md-4">
                                	<input name="articleId" id="articleId" value='<#if comment??>${comment.ctArticleId!}</#if>' type="text" class="form-control" 
                                	onkeyup="value=value.replace(/[^\d]/g,'')"
                                	<#if comment??>disabled</#if>
                                	>
                                </div>
                            </div>
                            <div class="form-group"
                            	style="<#if comment??><#if comment.ctType??><#if comment.ctType=2>display:block<#else>display:none</#if></#if><#else>display:none</#if>"
                            	id="productDiv">
                                <label class="control-label col-md-3">商品ID</label>
                                <div class="col-md-4">
                                	<input name="productId" id="productId" value='<#if comment??>${comment.ctProductId!}</#if>' type="text" class="form-control" 
                                	onkeyup="value=value.replace(/[^\d]/g,'')"
                                	<#if comment??>disabled</#if>>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-3">评论者ID</label>
                                <div class="col-md-4">
                                	<input name="discussantId" id="discussantId" value='<#if comment??>${comment.ctDiscussantId!}</#if>' type="text" class="form-control" 
                                	onkeyup="value=value.replace(/[^\d]/g,'')"
                                	<#if comment??>disabled</#if>>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-3">评论内容</label>
                                <div class="col-md-4">
                                	<input name="content" id="content" value='<#escape x as x?xml><#if comment??>${comment.ctContent!}</#if></#escape>' type="text" class="form-control" <#if comment??>disabled</#if>>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-3">是否可见</label>
                                <div class="col-md-4">
                                	<select class="form-control" name="invisible" id="invisible"> 
								      <option value="0" <#if comment??><#if comment.ctInvisible?string("1","0")=="0">selected</#if></#if>>可见</option> 
								      <option value="1" <#if comment??><#if comment.ctInvisible?string("1","0")=="1">selected</#if></#if>>不可见</option> 
								    </select>
                                </div>
                            </div>
                            <div class="form-group"">
                                <div class="col-md-offset-3 col-md-9">
                                    <button type="submit" id ='submit' class="btn default">保存</button>
                                    <button type="button" id ='cancel' class="btn default">取消</button>
                                </div>
                            </div>
                            
                            </#if>
                            </form>
                            <!-- END FORM-->
                        </div>
                    </div>
                    <!-- END VALIDATION STATES-->
                </div>
            </div>
        </div>
    </div>
    <!-- END PAGE -->
</div>
<!-- END CONTAINER -->
<!-- BEGIN FOOTER -->
<#include "../common/footer.html"/>
<!-- END FOOTER -->
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>

<!-- END CORE PLUGINS -->
 
<script>
var first = true;
jQuery(document).ready(function () {
    App.init();
    $("#layout").click(function(){
        if(first){
            layout();
            first = false;
        }else{
            resetLayout();
            first = true;
        }

    });
});


$("#submit").click(
	function() {
		var commentId = $('#commentId').val();
		var json = {};
		json
		if(typeof(commentId)=='undefined'||commentId==''){
			json['act']="add";
			/* type、articleId、productId、discussantId、content、invisible */
			var type = $('#type').val();
			json['type'] = type;
			if(typeof(type)=='undefined'||type==''||(type!='1'&&type!='2')){
				alert('评论类型错误，无法保存')
			}else if(type=='1'){
				var articleId = $('#articleId').val();
				if(typeof(articleId)=='undefined'||articleId==''){
					alert('请填写文章ID');
					$('#articleId').focus();
					return false;
				}
				json['articleId'] = articleId;
			}else{
				var productId = $('#productId').val();
				if(typeof(productId)=='undefined'||productId==''){
					alert('请填写商品ID');
					$('#productId').focus();
					return false;
				}
				json['productId'] = productId;
			}
			var discussantId = $('#discussantId').val();
			if(typeof(discussantId)=='undefined'||discussantId==''){
				alert('请填写评论者ID');
				$('#discussantId').focus();
				return false;
			}
			json['discussantId'] = discussantId;
			var content = $('#content').val();
			if(typeof(content)=='undefined'||content==''){
				alert('请填写评论内容');
				$('#content').focus();
				return false;
			}
			json['content'] = content;
			var invisible = $('#invisible').val();
			if(typeof(invisible)=='undefined'||invisible==''||(invisible!='1'&&invisible!='0')){
				alert('是否可见数据错误，无法保存')
				return false;
			}else{
				json['invisible']=invisible;
			}
			console.log("json="+json);
		}else{
			json['act']="upd";
			json['commentId']=commentId;
			var invisible = $('#invisible').val();
			if(typeof(invisible)=='undefined'||invisible==''||(invisible!='1'&&invisible!='0')){
				alert('是否可见数据错误，无法保存')
				return false;
			}else{
				json['invisible']=invisible;
			}
			console.log("json="+json);
		}
		$.ajax({
			url : '${base}/admin/comment/save',
			type : 'POST',
			data : json,
			dataType:'json',
			success : function(returndata) {
				if (returndata.code == "1") {
					alert(returndata.msg);
					window.location.href = '${base}/admin/comment/list';
				}else{
					alert(returndata.msg+"_"+returndata.code);
				}
			},
			error : function(returndata) {
				alert(returndata.msg+"_"+returndata.code);
				window.location.href = '${base}/admin/comment/list';
			}
		});
	});
$('#cancel').click(function(){
	window.location.href = '${base}/admin/comment/list';
});
function resetFormInput() { //清空表单
	$("form input").each(function() {
		$(this).val("");
	});
}
function select(obj){
	var value = $(obj).val();
	console.log("value="+value);
	if(value=="1"){
		$("#articleDiv").show();
		$("#productDiv").hide();
	}else if(value=="2"){
		$("#productDiv").show();
		$("#articleDiv").hide();
	}
}
/* function datachange(obj){
	var n = $(obj).val();
	if(n<0){
		$(obj).val(0-n);
	}
} */
</script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>